<?xml version='1.0' encoding='windows-1252'?>
<!-- Morphiq Lume Installer (WiX Toolset Configuration) -->

<?if $(sys.BUILDARCH) = x64 or $(sys.BUILDARCH) = arm64 ?>
    <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else ?>
    <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?endif ?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <Product
    Id='*'
    Name='Morphiq Lume'
    Manufacturer='Morphiq Technologies'
    UpgradeCode='D859D20E-3DD5-49DB-B13A-6A9A1F3D1DDB'
    Language='1033'
    Codepage='1252'
    Version='$(var.Version)'>

    <Package
      Id='*'
      InstallerVersion='450'
      Compressed='yes'
      InstallScope='perMachine'
      Description='Morphiq Lume â€” Transforming Human Resource Operations with Clarity, Precision, and Intelligence'
      Manufacturer='Morphiq Technologies'
      Languages='1033'
      SummaryCodepage='1252'/>

    <MajorUpgrade
      Schedule='afterInstallInitialize'
      DowngradeErrorMessage='A newer version of [ProductName] is already installed.'/>

    <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' DiskPrompt='Morphiq Lume Installer Disk'/>
    <Property Id='DiskPrompt' Value='Morphiq Lume Installation'/>

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='$(var.PlatformProgramFilesFolder)' Name='PFiles'>
        <Directory Id='APPLICATIONFOLDER' Name='Morphiq Lume'>

          <!-- Binary folder -->
          <Directory Id='Bin' Name='bin'>
            <Component Id='Path' Guid='1982CD76-51E4-4418-9719-193604BCA377' KeyPath='yes'>
              <Environment
                Id='PATH'
                Name='PATH'
                Value='[Bin]'
                Permanent='no'
                Part='last'
                Action='set'
                System='yes'/>
            </Component>

            <Component Id='binary0' Guid='*'>
              <File
                Id='exe0'
                Name='morphiq-lume.exe'
                DiskId='1'
                Source='$(var.CargoTargetBinDir)\morphiq-lume.exe'
                KeyPath='yes'/>
            </Component>

            <!-- Optional: embed icon in installer -->
            <Component Id='AppIcon' Guid='*'>
              <File Id='AppIconFile' Name='icon.ico' Source='assets\\logos\\icons\\full\\icon.ico' KeyPath='yes'/>
            </Component>
          </Directory>

          <!-- Optional: License -->
          <!--
          <Component Id='License' Guid='*'>
            <File Id='LicenseFile' Name='LICENSE.txt' DiskId='1' Source='LICENSE' KeyPath='yes'/>
          </Component>
          -->

        </Directory>
      </Directory>
    </Directory>

    <Feature
      Id='Binaries'
      Title='Morphiq Lume Application'
      Description='Installs all binaries, icons, and adds PATH entry.'
      Level='1'
      ConfigurableDirectory='APPLICATIONFOLDER'
      AllowAdvertise='no'
      Display='expand'
      Absent='disallow'>

      <ComponentRef Id='binary0'/>
      <ComponentRef Id='Path'/>
      <ComponentRef Id='AppIcon'/>

      <Feature
        Id='Environment'
        Title='PATH Environment Variable'
        Description='Adds Morphiq Lume to the system PATH.'
        Level='1'
        Absent='allow'>
        <ComponentRef Id='Path'/>
      </Feature>
    </Feature>

    <SetProperty Id='ARPINSTALLLOCATION' Value='[APPLICATIONFOLDER]' After='CostFinalize'/>
    <Property Id='ARPHELPLINK' Value='https://github.com/icarusvagner/morphiq-lume/wiki'/>
    <Property Id='ARPPRODUCTICON' Value='AppIconFile'/>

    <UI>
      <UIRef Id='WixUI_FeatureTree'/>
      <Publish Dialog='WelcomeDlg' Control='Next' Event='NewDialog' Value='CustomizeDlg' Order='99'>1</Publish>
      <Publish Dialog='CustomizeDlg' Control='Back' Event='NewDialog' Value='WelcomeDlg' Order='99'>1</Publish>
    </UI>

    <!-- Optional: EULA or custom graphics -->
    <!-- <WixVariable Id='WixUILicenseRtf' Value='assets\\EULA.rtf'/> -->
    <!-- <WixVariable Id='WixUIBannerBmp' Value='assets\\installer\\Banner.bmp'/> -->
    <!-- <WixVariable Id='WixUIDialogBmp' Value='assets\\installer\\Dialog.bmp'/> -->

  </Product>
</Wix>

